---
title: "Introduction to HPC"
subtitle: "Slurm Scheduler and Resource Manager"

author:
  - name: Manuel Holtgrewe
    orcid: 0000-0002-3051-1763
    affiliations:
      - ref: bihealth
affiliations:
  - id: bihealth
    name: Berlin Institute of Health at Charit√©
    address: Charit√©platz 1,
    postal-code: 10117
    city: Berlin
    country: Germany
title-slide-attributes:
  data-background-size: contain
  data-background-image: themes/bih/bih_bg_logo.png
format:
  revealjs:
    theme:
      - default
      - themes/bih/theme.scss
    slide-number: true
    navigation-mode: linear
    controls-layout: bottom-right
    controls-tutorial: false
    smaller: true
    self-contained: true
    # Override default "normal" size to get 16:9 aspect ratio.
    width: 1200
    height: 675
    margin: 0.05
    # Enable local plugins.
    revealjs-plugins:
      - plugins/fullscreen
---

## Session Overview

__Aims__

- Understand the role of Slurm as a scheduler and resource manager.
- Learn how to use Slurm to run jobs on the cluster and ...
- ... how to interrogate Slurm for cluster and job status.
- Using Conda and Apptainer for portable software installations.

__Actions__

- Submit interactive and batch jobs.
- Write Slurm job scripts.
- Query slurm with `squeue`, `sinfo` and `scontrol`.
- Using Conda and Apptainer

## Documentation Resources

:::: {.columns}

::: {.column width="50%"}

![](img/01-slurm/screenshot-hpc-docs.png)

[BIH HPC Docs](https://hpc-docs.cubi.bihealth.org/slurm/overview/)

:::

::: {.column width="50%"}

![](img/01-slurm/screenshot-slurm-docs.png)

[Official Slurm Documentation](https://slurm.schedmd.com/documentation.html)

:::

::::

ü§ì Google/Bing will help to find more

üëç User Forum at https://hpc-talk.cubi.bihealth.org!

## Slurm {.inverse background-color="#70ADC1"}

- Introduction
- Running Interactive and Batch Jobs
- Querying job and cluster status

## What is a Scheduler?

__Resource Manager__

- Slurm keeps a ledger of our node and job resources
  - [available]{.fragment .highlight-red} CPUs, memory, GPUs on each node
  - jobs and their [required]{.fragment .highlight-red} resources
  - currently running jobs and their [used]{.fragment .highlight-red} resources

__Job Scheduler__

- Slurm manages a schedule of submitted jobs
  - Freshly submitted jobs are subjected to [quick scheduling]{.fragment .highlight-red}
  - Periodically, Slurm will run [full backfill scheduling]{.fragment .highlight-red}

## Our First Interactive Job üé¨

```
srun --pty --time --partition=training --mem=10G --cpus-per-task=1 bash -i
```

## Our First Batch Job üé¨

## Looking at the Scheduler üé¨

:::: {.columns}

::: {.column width="50%"}

- sdiag
- squeue
- sinfo
- sprio

:::

::: {.column width="50%"}

:::

::::

## A dive into `scontrol show job`

## Slurm Partitions

## Tuning `squeue` Output

## Useful `.bashrc` Aliases

## The Role of Logging

## Neat Trick: `sattach`

## Ins and Outs of Job Scripts

## Submitting GPU Jobs

## Submitting High Memory Jobs

## Canceling Jobs with `scancel`

## Query Accounting Info with `sacct`

## QOS and `sacctmgr`

## Job Dependencies with `sbatch`

## X11 Forwarding with Slurm

## Reservations

## Conda {.inverse background-color="#70ADC1"}

- Introduction
- Installation
- Managing environments and instaling software

## Apptainer {.inverse background-color="#70ADC1"}

- Introduction
- Running `.sif` files with Apptainer
- Building `.sif` files from Docker containers
- Building `.sif` files from scratch

## Running `.sif` Image Files

## Converting Docker Image to `.sif` Files

## Building `.sif` Images from Scratch

## Bring Your Own Project {.inverse background-color="#70ADC1"}

ü´µ Where can you apply what you have learned in your PhD project?

## This is not the end...

... but all for this session

__Recap__

- Slurm
  - Introduction
  - Interactive and Batch Jobs
  - Query slurm for job and cluster status
- Conda
  - Installation and managing environments
- Apptainer
  - Introduction
  - Building and Running Images
